<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>

<div class="panel" id="list"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { collection, query, where, getDocs, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async user => {
  if (!user) location.href="index.html";
  const me = await getDoc(doc(db,"users",user.uid));
  if(!["moderator","elder"].includes(me.data().role)) location.href="main.html";

  const q = query(collection(db,"users"), where("situation","==","verified"));
  const snap = await getDocs(q);
  snap.forEach(d=>{
    const u = d.data();
    if(u.role==="moderator"||u.role==="elder") return;

    const row = document.createElement("div");
    row.className="row";
    row.innerHTML=`
      <div>#</div>
      <div>${u.nick}</div>
      <input type="number" value="${u.points}">
      <div class="actions">
        <button>Изменить</button>
      </div>
    `;
    row.querySelector("button").onclick = ()=>updateDoc(d.ref,{points:+row.querySelector("input").value});
    list.append(row);
  });
});
</script>
<script src="hudBackground.js"></script>
</body>
</html>
